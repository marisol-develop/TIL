# TIL(2022.05.23)

> date: 2022.05.23</br>
> ì§„í–‰ì¤‘ì¸ í”„ë¡œì íŠ¸: ios-open-market
> í™œë™í•™ìŠµ ì£¼ì œ: Understanding swift performance

## ğŸ‘©ğŸ»â€ğŸ’»í•™ìŠµë‚´ìš©

### ğŸ“Œ View Drawing ê°œë…

ë¨¼ì € ê³µì‹ë¬¸ì„œë¶€í„° ì‚´í´ë³´ë©´

> View drawing occurs on an as-needed basis. When a view is first shown, or when all or part of it becomes visible due to layout changes, the system asks the view to draw its contents
[UIView - The View Drawing Cycle](https://developer.apple.com/documentation/uikit/uiview)

_"ë·° ë“œë¡œì‰ì€ í•„ìš”ì— ë”°ë¼ ë°œìƒí•œë‹¤. ë·°ê°€ ì²˜ìŒ í‘œì‹œë˜ê±°ë‚˜, ë ˆì´ì•„ì›ƒ ë³€ê²½ìœ¼ë¡œ ì¸í•´ ë·°ì˜ ì „ë¶€ ë˜ëŠ” ì¼ë¶€ê°€ í‘œì‹œë  ë•Œ 
ì‹œìŠ¤í…œì€ ë·°ì—ê²Œ ë‚´ìš©ì„ ê·¸ë¦¬ë„ë¡ ìš”ì²­í•œë‹¤."_ ë¼ê³  ë¼ìˆë‹¤

ì‹œìŠ¤í…œì´ ë·°ì—ê²Œ "ì´ê±° ê·¸ë ¤ì¤˜!"ë¼ê³  ìš”ì²­í•˜ê¸° ìœ„í•´ì„œ `draw(_:)` ë©”ì„œë“œë¥¼ í˜¸ì¶œí•˜ëŠ” ê²ƒ ê°™ë‹¤
ê·¸ë˜ì„œ ìš°ë¦¬ëŠ” draw ë©”ì„œë“œë¥¼ ì§ì ‘ í˜¸ì¶œí•  ì¼ì´ ì—†ê³  í•´ì„œëŠ” ì•ˆëœë‹¤! ê³  í•˜ëŠ”ë°, draw ë©”ì„œë“œëŠ” ì•„ë˜ì—ì„œ ì‚´í´ë³´ê² ë‹¤

> When the actual content of your view changes, it is your responsibility to notify the system that your view needs to be redrawn.

_"ë·°ì˜ ì‹¤ì œ ë‚´ìš©ì´ ë³€ê²½ë˜ë©´, ë·°ë¥¼ ë‹¤ì‹œ ê·¸ë ¤ì•¼í•¨ì„ ì‹œìŠ¤í…œì—ê²Œ ì•Œë¦¬ëŠ” ê²ƒì€ ìš°ë¦¬ê°€ í•´ì•¼í•œë‹¤"
-> ì´ ë•Œ `setNeedsDisplay()` ë©”ì„œë“œë¥¼ í˜¸ì¶œí•œë‹¤_

ê·¼ë° ê·¸ëŸ¬ë©´ ë°”ë¡œ Displayê°€ ë˜ëŠ” ê²ƒì€ ì•„ë‹ˆê³ , ì˜ˆì•½?!í•˜ëŠ” ê²ƒê³¼ ë¹„ìŠ·í•œ ê°œë…ì¸ ê²ƒ ê°™ë‹¤
ë‹¤ìŒ drawing cycle ë™ì•ˆ viewë¥¼ ì—…ë°ì´íŠ¸í•´ì•¼í•¨ì„ ì‹œìŠ¤í…œì—ê²Œ ì•Œë ¤ì¤€ë‹¤
ê·¸ë˜ì„œ ì—¬ëŸ¬ ë·°ì—ì„œ `setNeedsDisplay()` ë©”ì„œë“œë¥¼ í˜¸ì¶œí•˜ë©´ ë‹¤ìŒ drawing cycleì—ì„œ ë™ì‹œì— ì—…ë°ì´íŠ¸ê°€ ê°€ëŠ¥í•˜ë‹¤ ğŸ¤“

ê·¼ë° ë˜ Documentation Archiveë¥¼ ì°¸ê³ í–ˆëŠ”ë°([Drawing and Printing Guide for iOS](https://developer.apple.com/library/archive/documentation/2DDrawing/Conceptual/DrawingPrintingiOS/GraphicsDrawingOverview/GraphicsDrawingOverview.html)), 
ì—¬ê¸°ì„œëŠ” `draw(_:)` ë©”ì„œë“œë¥¼ ëª¨ë‘ `drawRect(_:)` ë©”ì„œë“œë¡œ ì„¤ëª…í•˜ë˜ë°..
ì•Œê³ ë³´ë‹ˆ `drawRect(_:)` ì´ ì¹œêµ¬ëŠ” Objective-C ë©”ì„œë“œì˜€ë‹¤.. ì• í”Œì—ì„œ ì´ ë¬¸ì„œ ì—…ë°ì´íŠ¸ë¥¼ 2012ë…„ì„ ë§ˆì§€ë§‰ìœ¼ë¡œ í•˜ì§€ ì•Šì•˜..ğŸ¥²

ê³µì‹ë¬¸ì„œì—ì„œë„ `draw(_:)` ë©”ì„œë“œì˜ ìš°ì¸¡ ìƒë‹¨ languageë¥¼ swiftì—ì„œ Objective-Cë¡œ ì„ íƒí•˜ë©´ `drawRect(_:)`ë¡œ ë°”ë€ŒëŠ” ê±¸ ë³¼ ìˆ˜ ìˆì—ˆë‹¤

ê·¸ë¦¬ê³  ë·° ì—…ë°ì´íŠ¸ë¥¼ íŠ¸ë¦¬ê±°í•  ìˆ˜ ìˆëŠ” 4ê°€ì§€ ì•¡ì…˜ì„ ì„¤ëª…í•˜ê³  ìˆëŠ”ë°,
- ë¶€ë¶„ì ìœ¼ë¡œ ê°€ë ¤ì¡Œë˜ ë‹¤ë¥¸ ë·° ì´ë™ ë˜ëŠ” ì œê±°
- isHidden í”„ë¡œí¼í‹°ë¥¼ falseë¡œ ì„¤ì •í•˜ì—¬ ì´ì „ì— ìˆ¨ê²¨ì¡Œë˜ ë·°ë¥¼ ë‹¤ì‹œ í‘œì‹œ
- í™”ë©´ì—ì„œ ë·°ë¥¼ ìŠ¤í¬ë¡¤í•œ ë‹¤ìŒ, í™”ë©´ìœ¼ë¡œ ë‹¤ì‹œ ëŒì•„ì˜´
- ë·°ì˜ `setNeedsDisplay()` ë©”ì„œë“œë¥¼ ëª…ì‹œì ìœ¼ë¡œ í˜¸ì¶œ

ì‹¤í—˜í•´ë³´ë‹ˆ ë„¤ë²ˆì§¸ ë©”ì„œë“œ ëª…ì‹œì  í˜¸ì¶œ ì™¸ì—ëŠ” ë‹¤ë¥¸ ì•¡ì…˜ë“¤ì€ draw ë©”ì„œë“œê°€ í˜¸ì¶œë˜ì§€ ì•Šê³  ìˆì—ˆë‹¤ã… ã… ğŸ˜­
2012ë…„ ì´í›„ë¡œ ì—…ë°ì´íŠ¸ ë˜ì§€ ì•Šì€ ë¬¸ì„œë¼ì„œ ê·¸ëŸ° ê²ƒì¸ì§€,, í˜¼ë€í•˜ë‹¤ ğŸ˜µâ€ğŸ’«

### ğŸ“Œ draw(_:)

ê·¸ëŸ¼ ì´ ì¹œêµ¬ëŠ” ë­ê¸¸ë˜ ì§ì ‘ í˜¸ì¶œí•˜ë©´ ì•ˆë˜ëŠ”ê±´ì§€..

![](https://velog.velcdn.com/images/marisol/post/2f49c387-487e-4fdf-8b8c-06138cdd0e3d/image.png)

ì „ë‹¬ë°›ì€ ì§ì‚¬ê°í˜• ë‚´ì— ë¦¬ì‹œë²„ì˜ ì´ë¯¸ì§€ë¥¼ ê·¸ë¦°ë‹¤.. ë¼ê³  ë˜ì–´ ìˆê³ 
íŒŒë¼ë¯¸í„°ë¡œ ë°›ëŠ” rect ë‚´ë¶€ì— ë­”ê°€ë¥¼ ê·¸ë¦°ë‹¤ëŠ” ê²ƒ ê°™ì€ë°..

ê·¸ëŸ¼ íŒŒë¼ë¯¸í„°ë¡œ ë°›ëŠ” rectì˜ ì„¤ëª…ì„ ìì„¸íˆ ë³´ë©´

> The portion of the viewâ€™s bounds that needs to be updated. The first time your view is drawn, this rectangle is typically the entire visible bounds of your view. However, during subsequent drawing operations, the rectangle may specify only part of your view.

_"ì—…ë°ì´íŠ¸ í•´ì•¼ í•˜ëŠ” ë·°ì˜ ê²½ê³„ ë¶€ë¶„. ë·°ë¥¼ ì²˜ìŒ ê·¸ë¦´ ë•ŒëŠ” ì¼ë°˜ì ìœ¼ë¡œ ë·°ì˜ ì „ì²´ ê°€ì‹œì  ê²½ê³„ì´ì§€ë§Œ, ì´í›„ ê·¸ë¦¬ê¸° ì‘ì—… ì¤‘ì—ëŠ” ì§ì‚¬ê°í˜•ì´ ë·°ì˜ ì¼ë¶€ë§Œ ì§€ì •í•  ìˆ˜ ìˆë‹¤"_

ìƒë‹¹í•œ ë²ˆì—­ì²´ì§€ë§ŒğŸ¥², ì˜ë¯¸ëŠ” ì´í•´ê°€ ë˜ëŠ” ê²ƒ ê°™ë‹¤
ë§¨ ì²˜ìŒì— ë·° ë“œë¡œì‰ ì‚¬ì´í´ ì„¤ëª…í•˜ë©´ì„œ "ë·°ê°€ ì²˜ìŒ í‘œì‹œë˜ê±°ë‚˜, ë ˆì´ì•„ì›ƒ ë³€ê²½ìœ¼ë¡œ ì¸í•´ ë·°ì˜ ì „ë¶€ ë˜ëŠ” ì¼ë¶€ê°€ í‘œì‹œë  ë•Œ ì‹œìŠ¤í…œì€ ë·°ì—ê²Œ ë‚´ìš©ì„ ê·¸ë¦¬ë„ë¡ ìš”ì²­í•œë‹¤"ê³  í–ˆëŠ”ë°,
ë·°ê°€ ì²˜ìŒ í‘œì‹œë  ë•ŒëŠ” rectê°€ ë·°ì˜ ì „ì²´ ê°€ì‹œì  ê²½ê³„ë¥¼ ë‚˜íƒ€ë‚´ì§€ë§Œ, ì´í›„ì—ëŠ” rectê°€ ë·°ì˜ ì¼ë¶€ê°€ ë  ìˆ˜ ìˆë‹¤ëŠ” ëœ»ì¸ ê²ƒ ê°™ë‹¤

ê·¸ë¦¬ê³  Discussionì˜ ë§ˆì§€ë§‰ì— ë³´ë©´ ì§ì ‘ í˜¸ì¶œí•˜ë©´ ì•ˆë˜ê³ , ëŒ€ì‹  ë‹¤ë¥¸ ë©”ì„œë“œë¥¼ í†µí•´ í˜¸ì¶œí•˜ë¼ëŠ” ë‚´ìš©ì´ ë‚˜ì™€ìˆë‹¤

> This method is called when a view is first displayed or when an event occurs that invalidates a visible part of the view. You should never call this method directly yourself. To invalidate part of your view, and thus cause that portion to be redrawn, call the `setNeedsDisplay()` or `setNeedsDisplay(_:)` method instead.

_"ì´ ë©”ì„œë“œëŠ” ë·°ê°€ ì²˜ìŒ í‘œì‹œë˜ê±°ë‚˜, ë·°ì˜ ì¼ë¶€ë¥¼ ë¬´íš¨í™”í•˜ëŠ” ì´ë²¤íŠ¸ê°€ ë°œìƒí•  ë•Œ í˜¸ì¶œëœë‹¤. ì´ ë©”ì„œë“œë¥¼ ì§ì ‘ í˜¸ì¶œí•´ì„œëŠ” ì•ˆëœë‹¤.
ë·°ì˜ ì¼ë¶€ë¥¼ ë¬´íš¨í™”í•˜ì—¬ í•´ë‹¹ ë¶€ë¶„ì„ ë‹¤ì‹œ ê·¸ë¦¬ë ¤ë©´ `setNeedsDisplay()` ë©”ì„œë“œë¥¼ ëŒ€ì‹  í˜¸ì¶œí•´ë¼."_

ê·¸ëŸ¬ë‹ˆê¹Œ ë·°ê°€ ì—…ë°ì´íŠ¸ë˜ë©´ ì§ì ‘ `draw(_:)`ë¥¼ í˜¸ì¶œí•˜ì§€ ë§ê³ , `setNeedsDisplay()`ë¥¼ í˜¸ì¶œí•˜ë©´
ì‹œìŠ¤í…œì´ ê·¸ ë·°ë¥¼ ë‹¤ìŒ ë“œë¡œì‰ ì‚¬ì´í´ ë•Œ ë³€ê²½í•´ì¤„ ê²ƒì´ë‹¤! ë¼ê³  ìƒê°í•˜ë©´ ë  ê²ƒ ê°™ë‹¤.

### ğŸ“Œ View Drawing Cycle

í™œë™í•™ìŠµì—ì„œ view drawing cycle ê´€ë ¨ ë©”ì„œë“œì˜ í˜¸ì¶œ ìˆœì„œê°€, ì•„ë˜ì™€ ê°™ì„ ê²ƒì´ë¼ê³  ê°€ì •í•˜ê³  ì‹¤í—˜ì„ í•´ë³´ì•˜ë‹¤

`viewWillAppear` -> `updateConstraints` -> `updateViewConstraints` -> `viewWillLayoutSubviews` -> `layoutSubviews` -> `viewDidLayoutSubviews` -> `draw` -> `viewDidAppear`

ê·¸ëŸ°ë° ì‹¤í—˜ ê²°ê³¼ ë‹¤ë¥¸ ë¶€ë¶„ì´ ìˆì—ˆëŠ”ë°..
`viewDidLayoutSubviews`ê°€ `layoutSubviews`ë³´ë‹¤ ë” ë¨¼ì € ë¶ˆë ¤ë²„ë ¸ë‹¤...[](https://velog.velcdn.com/images/marisol/post/92607e46-f32d-4b36-9358-77750cea46cf/image.png)

`viewDidLayoutSubviews()` ë©”ì„œë“œì˜ ì •ì˜ë¥¼ ë³´ë©´, 

> Called to notify the view controller that its view has just laid out its subviews.

_ë·°ì»¨íŠ¸ë¡¤ëŸ¬ì˜ ë·°ê°€ ì„œë¸Œë·°ë“¤ì˜ ë°°ì¹˜ë¥¼ ëëƒˆë‹¤ëŠ” ê²ƒì„ ì•Œë¦¬ê¸° ìœ„í•´ í˜¸ì¶œë¨_

ì´ë¼ê³  ë˜ì–´ ìˆì–´ì„œ ë”ìš± ë” ì´í•´ê°€ ì•ˆê°”ëŠ”ë°.. Discussionì„ ì½ë‹¤ë³´ë‹ˆ ì´ëŸ° ë‚´ìš©ì„ ë°œê²¬í–ˆë‹¤

> However, this method being called does not indicate that the individual layouts of the view's subviews have been adjusted. Each subview is responsible for adjusting its own layout.

_ì´ ë©”ì„œë“œëŠ” ë·°ì˜ ì„œë¸Œë·°ë“¤ì˜ ê°œë³„ ë ˆì´ì•„ì›ƒì´ ì¡°ì •ë˜ì—ˆìŒì„ ë‚˜íƒ€ë‚´ì§€ ì•ŠëŠ”ë‹¤. ê° ì„œë¸Œë·°ë“¤ì€ ìì²´ ë ˆì´ì•„ì›ƒì„ ì¡°ì •í•  ì±…ì„ì´ ìˆë‹¤._

;;;;;;

ìš°ì„  ë¨¼ì € ìƒê°í•´ì•¼ í•  ê²ƒì€, ê° ë©”ì„œë“œë¥¼ ê´€ë¦¬í•˜ëŠ” ì£¼ì²´ê°€ ë‹¤ë¥´ë‹¤ëŠ” ê²ƒ ê°™ë‹¤.

`viewDidLayoutSubviews()` ë©”ì„œë“œëŠ” viewControllerì´ ê´€ë¦¬í•˜ê³ ,
`layoutSubviews()`ëŠ” viewì—ì„œ ê´€ë¦¬í•˜ê³  ìˆë‹¤

ì‹¤ì œë¡œ ë­”ê°€ë¥¼ ê·¸ë¦´ë•Œ ë°‘ë°”íƒ•ì„ ë¨¼ì € ê·¸ë ¤ì•¼í•˜ëŠ” ê²ƒì²˜ëŸ¼, ë·°ì»¨íŠ¸ë¡¤ëŸ¬ê°€ ê°–ê³  ìˆëŠ” ì»¤ë‹¤ë€ ë·°ê°€ ë¨¼ì € ë ˆì´ì•„ì›ƒì„ ì¡ì•„ì•¼ë§Œ ê·¸ ë·°ì˜ ì„œë¸Œë·°ë„ ë ˆì´ì•„ì›ƒì„ ì¡ì„ ìˆ˜ ìˆëŠ”ê²ƒ ê°™ë‹¤

ì—¬ê¸°ì„œ ì‚´ì§ ì–˜ê¸°í•œ `layoutSubviews()` ë©”ì„œë“œ ë˜í•œ `draw(_:)` ë©”ì„œë“œì²˜ëŸ¼ ì§ì ‘ í˜¸ì¶œí•´ì„œëŠ” ì•ˆë˜ëŠ” ë©”ì„œë“œë¼ê³  í•œë‹¤
ê·¸ë˜ì„œ `layoutSubviews()`ì˜ ê³µì‹ë¬¸ì„œë¥¼ ë³´ë©´ `setNeedsLayout()` ë©”ì„œë“œë‚˜ `layoutIfNeeded()` ë©”ì„œë“œë¥¼ í†µí•´ ê°„ì ‘ì ìœ¼ë¡œ í˜¸ì¶œí•˜ë¼ê³  ë‚˜ì™€ìˆë‹¤

- `draw(_:)` -> `setNeedsDisplay()`ë¥¼ í†µí•´ ê°„ì ‘ í˜¸ì¶œ
- `layoutSubviews()` -> `setNeedsLayout()`ë‚˜ `layoutIfNeeded()`ë¥¼ í†µí•´ ê°„ì ‘ í˜¸ì¶œ

ì´ë ‡ê²Œ ê¸°ì–µí•˜ë©´ ë  ê²ƒ ê°™ë‹¤ ğŸ¤“

---

ì°¸ê³ ìë£Œ
- https://developer.apple.com/documentation/uikit/uiview/1622529-draw
- https://developer.apple.com/library/archive/documentation/2DDrawing/Conceptual/DrawingPrintingiOS/GraphicsDrawingOverview/GraphicsDrawingOverview.html
- https://zeddios.tistory.com/359
