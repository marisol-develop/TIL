## ğŸ¦„ Core Animation

Core Animationì€ iOSì™€ OS X ëª¨ë‘ì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ê·¸ë˜í”½ ëœë”ë§ ë° ì• ë‹ˆë©”ì´ì…˜ ì¸í”„ë¼ë¥¼ ë§í•˜ë©°, 
`ì•±ì˜ ë·° ë° ê¸°íƒ€ ì‹œê°ì  ìš”ì†Œë¥¼ ì• ë‹ˆë©”ì´ì…˜í™”` í•˜ëŠ”ë° ì‚¬ìš©ëœë‹¤ê³  í•œë‹¤.

ì• í”Œ ì•„ì¹´ì´ë¸Œ ë¬¸ì„œì˜ [Core Animation Basics](https://developer.apple.com/library/archive/documentation/Cocoa/Conceptual/CoreAnimation_guide/CoreAnimationBasics/CoreAnimationBasics.html#//apple_ref/doc/uid/TP40004514-CH2-SW3)ë¥¼ ë³´ë©´, ê°€ì¥ ë¨¼ì € `Layers Provide the Basis for Drawing and Animations`ë¼ëŠ” íŒŒíŠ¸ê°€ ë‚˜ì˜¨ë‹¤.

ê·¸ë˜ì„œ ê·¸ íŒŒíŠ¸ë¥¼ ë‹¤ë£¨ê¸° ì „ì— ë¨¼ì € layerì˜ ê³µì‹ë¬¸ì„œë¥¼ ì‚´í´ë³´ìë©´,

![](https://velog.velcdn.com/images/marisol/post/6d7a2513-3b08-4fe7-8572-47c4a150e404/image.png)

layerëŠ” `ë Œë”ë§ì— ì‚¬ìš©ë˜ëŠ” ë·°ì˜ Core Animation layer`ë¼ê³  ì •ì˜ë˜ì–´ ìˆë‹¤.
ê·¸ë¦¬ê³  Discussionì— layerëŠ” ì ˆëŒ€ 0ì´ ë  ìˆ˜ ì—†ê³ , ë·°ëŠ” layerì˜ delegate(ìœ„ì„ì)ë¼ê³  ë˜ì–´ ìˆë‹¤.

Discussion ë°‘ì— ë¹¨ê°„ìƒ‰ ê²½ê³ ë¡œ, 
ğŸš« ë·°ê°€ layerì˜ ìœ„ì„ìë‹ˆê¹Œ, viewë¥¼ ë‹¤ë¥¸ CALayer ê°ì²´ì˜ ìœ„ì„ìë¡œ ë§Œë“¤ì§€ ë§ì•„ë¼.. 
ğŸš« ê·¸ë¦¬ê³  ì´ layer ê°ì²´ì˜ ìœ„ì„ìë¥¼ ë³€ê²½í•˜ì§€ ë§ì•„ë¼.. ë¼ê³  ê²½ê³ í•˜ê³  ìˆë‹¤

ê·¸ëŸ¬ë‹ˆê¹Œ ëª¨ë“  ë·° ê°ì²´ëŠ” Core Animation Layerë¥¼ ê°€ì§€ê³  ìˆëŠ”ë°, ì´ Core Animation LayerëŠ” ë·°ì˜ ì»¨í…ì¸ ë¥¼ ê´€ë¦¬í•˜ê³ , ì• ë‹ˆë©”ì´ì…˜í™” í•´ì£¼ëŠ” ì—­í• ì„ í•œë‹¤ëŠ” ê²ƒ ê°™ë‹¤.

ë‹¤ì‹œ ì• í”Œ ì•„ì¹´ì´ë¸Œ ë¬¸ì„œë¥¼ ì‚´í´ë³´ë©´, 
> ëŒ€ë¶€ë¶„ì˜ layersëŠ” ì•±ì—ì„œ ì‹¤ì œ drawingì„ ìˆ˜í–‰í•˜ì§€ ì•ŠëŠ”ë‹¤. ëŒ€ì‹  layerëŠ” ì•±ì´ ì œê³µí•˜ëŠ” ì»¨í…ì¸ ë¥¼ `ìº¡ì²˜`í•˜ì—¬ ë¹„íŠ¸ë§µì— ìºì‹œí•œë‹¤.
ë‚˜ì¤‘ì— layerì˜ í”„ë¡œí¼í‹°ë¥¼ ë³€ê²½í•˜ë©´, layer ê°ì²´ì™€ ì—°ê´€ëœ ìƒíƒœ ì •ë³´ë§Œ ë³€ê²½ëœë‹¤.
ë³€ê²½ ì‚¬í•­ì´ ì• ë‹ˆë©”ì´ì…˜ì„ íŠ¸ë¦¬ê±°í•˜ë©´, Core Animationì€ layerì˜ ë¹„íŠ¸ë§µê³¼ ìƒíƒœ ì •ë³´ë¥¼ ê·¸ë˜í”½ í•˜ë“œì›¨ì–´ì— ì „ë‹¬í•œë‹¤. 
ê·¸ë˜í”½ í•˜ë“œì›¨ì–´ëŠ” ìƒˆë¡œìš´ ì •ë³´ë¥¼ ì‚¬ìš©í•´ì„œ ë¹„íŠ¸ë§µì„ ë Œë”ë§í•˜ëŠ” ì‘ì—…ì„ ìˆ˜í–‰í•œë‹¤. 
í•˜ë“œì›¨ì–´ì—ì„œ ë¹„íŠ¸ë§µì„ ì¡°ì‘í•˜ëŠ” ê²ƒì€ ì†Œí”„íŠ¸ì›¨ì–´ì—ì„œ í•˜ëŠ” ê²ƒë³´ë‹¤ í›¨ì”¬ ë” ë¹ ë¥¸ ì• ë‹ˆë©”ì´ì…˜ì„ ìƒì„±í•œë‹¤.

ë¼ê³  ë˜ì–´ìˆëŠ”ë°, ê·¸ë¦¼ì„ ë³´ë©´ ì¢€ ë” ì´í•´ê°€ ì‰½ë‹¤.

![](https://velog.velcdn.com/images/marisol/post/6eb42211-5109-4e29-b07a-6dd4bf40db59/image.png)

LayerëŠ” App Windowì—ì„œ ì œê³µí•˜ëŠ” ì»¨í…ì¸ ë¥¼ ìº¡ì³í•´ì„œ ë¹„íŠ¸ë§µ (Backing Store)ì— ìºì‹±
-> ìº¡ì³í•´ë‘” ê²ƒê³¼ ë³€ê²½ì‚¬í•­ì´ ë°œìƒí•´ì„œ ì• ë‹ˆë©”ì´ì…˜ì´ íŠ¸ë¦¬ê±° 
-> Core Animationì´ Layerì˜ ë¹„íŠ¸ë§µê³¼ ìƒíƒœ ì •ë³´ë¥¼ ê·¸ë˜í”½ í•˜ë“œì›¨ì–´ì— ì „ë‹¬
-> ê·¸ë˜í”½ í•˜ë“œì›¨ì–´ê°€ ìƒˆ ì •ë³´ë¥¼ ì‚¬ìš©í•´ì„œ ë¹„íŠ¸ë§µì„ ë Œë”ë§

ìš”ëŸ° í”„ë¡œì„¸ìŠ¤ì¸ê²ƒ ê°™ë‹¤. layerê°€ ì§ì ‘ ë­˜ ê·¸ë¦¬ëŠ”ê²Œ ì•„ë‹ˆë¼, layerê°€ ìº¡ì³í•´ì„œ ìºì‹±í•´ë‘” ë¹„íŠ¸ë§µê³¼ ìƒíƒœ ì •ë³´ë¥¼ Core Animationì´ ê·¸ë˜í”½ í•˜ë“œì›¨ì–´í•œí…Œ ì „ë‹¬í•˜ë©´ ê·¸ë˜í”½ í•˜ë“œì›¨ì–´ê°€ ë Œë”ë§ì„ í•œë‹¤ëŠ” ê²ƒ ê°™ë‹¤.

ê·¸ë¦¬ê³  layerì—ì„œ ìˆ˜í–‰í•  ìˆ˜ ìˆëŠ” ì• ë‹ˆë©”ì´ì…˜ ìœ í˜•ì€ ë‹¤ì–‘í•œë°, ì˜¤ëŠ˜ì€ Rotateì„ ì¨ë³¼ê±°ë‹¤!

![](https://velog.velcdn.com/images/marisol/post/9bca01fb-5b72-414b-a659-8ebbf472233b/image.png)

## â™»ï¸ Core Animationìœ¼ë¡œ ë²„íŠ¼ íšŒì „ì‹œì¼œë³´ê¸°

### ğŸ“Œ 1. íšŒì „ëœ ìƒíƒœì¸ì§€ ì—¬ë¶€ë¥¼ ë‚˜íƒ€ë‚´ëŠ” bool íƒ€ì…ì˜ flag ìƒì„±

íšŒì „ëœ ìƒíƒœì—ì„œ ë²„íŠ¼ì„ í´ë¦­í–ˆì„ ë•Œ -> ì›ë˜ ìƒíƒœë¡œ ëŒì•„ì˜¤ê¸°
ì›ë˜ ìƒíƒœì—ì„œ ë²„íŠ¼ì„ í´ë¦­í–ˆì„ ë•Œ -> íšŒì „í•˜ê¸°

ì´ë ‡ê²Œ êµ¬í˜„í•˜ê¸° ìœ„í•´ì„œ ë¨¼ì € flagë¥¼ ì„¤ì •í•´ì£¼ì—ˆë‹¤

```swift
var isRotated: Bool = false
```

### ğŸ“Œ 2. ë²„íŠ¼ í´ë¦­ Action ë©”ì„œë“œ ë‚´ë¶€ì— íšŒì „ ì½”ë“œ ì‘ì„±

1) ì• ë‹ˆë©”ì´ì…˜ ì œê³µí•˜ëŠ” CABasicAnimation ê°ì²´ ìƒì„± 
2) ì• ë‹ˆë©”ì´ì…˜ ì‹œì‘í•  ê°’ì„ ì •ì˜
3) ì• ë‹ˆë©”ì´ì…˜ ëë‚  ê°’ì„ ì •ì˜
4) ì• ë‹ˆë©”ì´ì…˜ ì§€ì† ì‹œê°„ ì •ì˜
5) ì• ë‹ˆë©”ì´ì…˜ì´ ëë‚  ìƒíƒœë¡œ ê³ ì •
6) ë²„íŠ¼ layerì˜ render treeì— ìœ„ ì• ë‹ˆë©”ì´ì…˜ ê°ì²´ ì¶”ê°€

```swift
let rotation = CABasicAnimation(keyPath: "transform.rotation")
rotation.fromValue = 0 
rotation.toValue = Double.pi / 4.5
rotation.duration = 0.25
rotation.fillMode = .forwards
rotation.isRemovedOnCompletion = false
plusButton.layer.add(rotation, forKey: "rotationAnimation")
```

### ğŸ“Œ 3. 1ë²ˆì˜ flag ê°’ìœ¼ë¡œ ë¶„ê¸°ì²˜ë¦¬
1) falseì¼ ë•Œ ìœ„ 2ë²ˆì„ ì‹¤í–‰í•˜ê³ , ë§ˆì§€ë§‰ì— isRotated = trueë¡œ í• ë‹¹í•´ì£¼ëŠ” ì½”ë“œë¥¼ ì¶”ê°€
2) ë‹¤ì‹œ ë˜ëŒë¦¬ëŠ” ê¸°ëŠ¥ì€ rotation.fromValueì™€ rotation.toValueì˜ ê°’ì„ ë°”ê¿”ì„œ êµ¬í˜„ + isRotated = falseë¡œ í• ë‹¹

ê·¸ëŸ¬ë©´ ì²˜ìŒ ë²„íŠ¼ì„ ëˆŒë €ì„ë•ŒëŠ” 40ë„ íšŒì „í•˜ê³ , ë‹¤ì‹œ ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ ì›ë˜ ìƒíƒœë¡œ ëŒì•„ì˜¤ê²Œ ëœë‹¤ğŸ¤“

![](https://velog.velcdn.com/images/marisol/post/e026ff55-8daf-4709-b96d-cf3cf8f94c61/image.gif)

---
ì°¸ê³ ìë£Œ
- https://developer.apple.com/library/archive/documentation/Cocoa/Conceptual/CoreAnimation_guide/CoreAnimationBasics/CoreAnimationBasics.html#//apple_ref/doc/uid/TP40004514-CH2-SW3
- https://developer.apple.com/documentation/uikit/uiview/1622436-layer
